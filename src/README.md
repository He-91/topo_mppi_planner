# ğŸš DDO-TOPO-MPPI åŠ¨æ€éšœç¢ç‰©æ‹“æ‰‘è½¨è¿¹è§„åˆ’ç³»ç»Ÿ

**åŸºäº**: FastPlanner + MPPI-Generic + åŠ¨æ€éšœç¢ç‰©é¢„æµ‹  
**æ ¸å¿ƒ**: Topo-PRM â†’ MPPIä¼˜åŒ– â†’ B-splineå¹³æ»‘ ä¸‰çº§æ¶æ„  
**æ€§èƒ½**: âœ… 100%æˆåŠŸç‡, 17mså®æ—¶å“åº”

---

## ğŸ‰ æœ€æ–°æ”¹è¿› (2025-12-27)

### â­ P0: å®Œæ•´MPPIè½¨è¿¹æå–
**æ–‡ä»¶**: `planner/bspline_opt/src/bspline_optimizer_esdf_mppi.cpp`

**æ”¹è¿›å†…å®¹**:
- âœ… è¿”å›å®Œæ•´30ç‚¹MPPIä¼˜åŒ–è½¨è¿¹ (åŸç‰ˆä»…10-15ç‚¹B-splineæ§åˆ¶ç‚¹)
- âœ… åŒ…å«ä½ç½®ã€é€Ÿåº¦ã€æ—¶é—´æˆ³å®Œæ•´ä¿¡æ¯
- âœ… ä¸ºè½¨è¿¹è·Ÿè¸ªåé¦ˆ(P2)æä¾›é«˜è´¨é‡å‚è€ƒ

**å…³é”®ä»£ç **:
```cpp
// æå–å®Œæ•´MPPIè½¨è¿¹å¹¶è¿”å›
result.positions.reserve(num_rollout_points);
result.velocities.reserve(num_rollout_points);
for (size_t i = 0; i < num_rollout_points; ++i) {
    result.positions.push_back(Eigen::Vector3d(
        rollout_states[0][i], rollout_states[1][i], rollout_states[2][i]));
    result.velocities.push_back(Eigen::Vector3d(
        rollout_states[3][i], rollout_states[4][i], rollout_states[5][i]));
}
ROS_INFO("[MPPI-GPU] ğŸ¯ P0: Extracted full %zu-point optimized trajectory (cost=%.2f)",
         result.positions.size(), total_cost);
```

**æµ‹è¯•ç»“æœ**: âœ… 100%æˆåŠŸï¼Œæ¯æ¬¡è§„åˆ’ç¨³å®šæå–30ç‚¹è½¨è¿¹

---

### â­ P2: è½¨è¿¹è·Ÿè¸ªè¯¯å·®åé¦ˆ (ç›‘æ§æ¨¡å¼)
**æ–‡ä»¶**: 
- `planner/plan_manage/include/plan_manage/planner_manager.h`
- `planner/plan_manage/src/planner_manager.cpp`
- `planner/plan_manage/src/ego_replan_fsm.cpp`

**æ”¹è¿›å†…å®¹**:
- âœ… å®æ—¶è®¡ç®—è·Ÿè¸ªè¯¯å·® (ä½ç½® + é€Ÿåº¦)
- âœ… PDåé¦ˆæ§åˆ¶ (Kp=2.0, Kd=1.0, é™å¹…1.0m/sÂ²)
- âœ… çº¿æ€§æ—¶é—´æ’å€¼ (ç²¾ç¡®åŒ¹é…å½“å‰æ—¶åˆ»)
- âœ… å®‰å…¨ç›‘æ§æ¨¡å¼ (ä¸è§¦å‘è‡ªåŠ¨é‡è§„åˆ’)

**æ ¸å¿ƒæ¶æ„**:
```cpp
struct TrajectoryReference {
    std::vector<Eigen::Vector3d> positions;   // 30ç‚¹ä½ç½®
    std::vector<Eigen::Vector3d> velocities;  // 30ç‚¹é€Ÿåº¦
    std::vector<double> timestamps;           // æ—¶é—´æˆ³åºåˆ—
    double start_time;                        // è½¨è¿¹èµ·å§‹æ—¶é—´
    bool valid;                               // æœ‰æ•ˆæ€§æ ‡å¿—
};

// PDåé¦ˆæ§åˆ¶
Eigen::Vector3d correction = feedback_kp_ * pos_error + feedback_kd_ * vel_error;
double magnitude = correction.norm();
if (magnitude > feedback_max_correction_) {
    correction = correction.normalized() * feedback_max_correction_;
}
```

**ç›‘æ§æ•°æ®ç¤ºä¾‹** (test.txt):
```
[P2 Tracking] Error: pos=0.221m, vel=1.096m/s, correction=1.000m/sÂ² (é™å¹…)
[P2 Tracking] Error: pos=0.360m, vel=0.182m/s, correction=0.853m/sÂ²
[P2 Tracking] Error: pos=0.732m, vel=0.891m/s, correction=1.000m/sÂ² (é™å¹…)
[P2 Tracking] Error: pos=0.349m, vel=0.291m/s, correction=0.492m/sÂ²
```

**æµ‹è¯•ç»“æœ** (æœ€æ–°2025-12-28): 
- âœ… è§„åˆ’æˆåŠŸç‡: 22/22 = 100%
- âœ… P0è½¨è¿¹æå–: 76/76 = 100% (30ç‚¹å®Œæ•´è½¨è¿¹)
- âœ… P2å‚è€ƒä¿å­˜: 22æ¬¡æˆåŠŸ
- âœ… P2è¯¯å·®ç›‘æ§: 17æ¬¡ (1Hzé¢‘ç‡)
- âœ… é›¶ERRORï¼Œç³»ç»Ÿå®Œå…¨ç¨³å®š
- âš ï¸ ä½ç½®è¯¯å·®: 0.153m ~ 4.086m (æœ€å¤§å€¼åå¤§ï¼Œå»ºè®®å¯ç”¨P2ä¿å®ˆé‡è§„åˆ’)

---

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

èåˆ **Topo-PRM** + **MPPIä¼˜åŒ–** + **B-splineå¹³æ»‘** + **åŠ¨æ€é¢„æµ‹** çš„å®æ—¶è§„åˆ’ç³»ç»Ÿã€‚

### æ ¸å¿ƒæŒ‡æ ‡ (åŸºäºæœ€æ–°æµ‹è¯• 2025-12-28)
- âœ… æˆåŠŸç‡: **100%** (22/22æ¬¡è§„åˆ’é›¶å¤±è´¥)
- âš¡ å®æ—¶æ€§: **<30ms** (å¤§éƒ¨åˆ†è§„åˆ’åœ¨30mså†…å®Œæˆ)
- ğŸŒ æ‹“æ‰‘è·¯å¾„: **1-6æ¡** (å¹³å‡3.5æ¡/æ¬¡)
- ğŸ¯ MPPIæˆæœ¬: **124-261** (å½’ä¸€åŒ–ï¼Œå¹³å‡154.8)
- ğŸ”® åŠ¨æ€éšœç¢ç‰©: **12æ¬¡æ£€æµ‹** (2.33m-4.90m)
- ğŸš€ P0è½¨è¿¹: **30ç‚¹å®Œæ•´è½¨è¿¹** (76/76=100%æˆåŠŸ)
- ğŸ“Š P2ç›‘æ§: **17æ¬¡è¯¯å·®ç›‘æ§** (ä½ç½®è¯¯å·®0.15m-4.09m)



------



## ğŸ—ï¸ ç®—æ³•æ¡†æ¶æ€»è§ˆ## ğŸ—ï¸ è§„åˆ’æµç¨‹



``````

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”Fast-Planner TopoPRMæ‹“æ‰‘è·¯å¾„ç”Ÿæˆ (<1ms)

â”‚                    ä¸‰çº§è½¨è¿¹è§„åˆ’æ¶æ„                              â”‚  â”œâ”€ GuardèŠ‚ç‚¹é‡‡æ · (çŸ©å½¢ç›’å­: XÂ±1.0m, YÂ±3.5m, ZÂ±1.0m)

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”œâ”€ ConnectorèŠ‚ç‚¹é‡‡æ · (å¯†é›†åŒºåŸŸè¿æ¥)

                              â”‚  â”œâ”€ å¯è§æ€§å›¾æ„å»º (EDTè·ç¦»æ£€æµ‹ + æ¢¯åº¦æ£€æŸ¥)

                              â–¼  â”œâ”€ ä¸¤é˜¶æ®µDFSæœç´¢ (ç”Ÿæˆ300æ¡åŸå§‹è·¯å¾„)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”œâ”€ Shortcutè·¯å¾„ä¼˜åŒ– (visibility-based shortening)

â”‚  LEVEL 1: æ‹“æ‰‘è·¯å¾„ç”Ÿæˆ (TopoPRM)                    <1ms        â”‚  â”œâ”€ æ‹“æ‰‘æ£€æŸ¥ (åŒæ‹“æ‰‘è·¯å¾„å»é‡)

â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â””â”€ è¿­ä»£é€‰æ‹© (ratio_to_short=5.5, ä¿ç•™6æ¡æœ€ä¼˜è·¯å¾„)

â”‚  è¾“å…¥: start_pos, goal_pos, EDTåœ°å›¾                              â”‚        â†“

â”‚  æ–¹æ³•: PRM (Probabilistic Roadmap)                              â”‚å¹¶è¡ŒMPPIä¼˜åŒ– (10.85ms)

â”‚  è¾“å‡º: 1-8æ¡æ‹“æ‰‘ä¸åŒçš„å‡ ä½•è·¯å¾„                                   â”‚  â”œâ”€ Level 1: å¤šè·¯å¾„å¹¶è¡Œ (#pragma omp parallel for)

â”‚                                                                 â”‚  â”œâ”€ Level 2: 1000é‡‡æ ·å¹¶è¡Œ (çº¿ç¨‹å®‰å…¨RNG)

â”‚  æ­¥éª¤è¯¦è§£:                                                       â”‚  â””â”€ é€‰æ‹©å½’ä¸€åŒ–æˆæœ¬æœ€å°è·¯å¾„

â”‚  1ï¸âƒ£ GuardèŠ‚ç‚¹é‡‡æ · (start/goalå‘¨å›´çš„çŸ©å½¢ç›’å­)                     â”‚        â†“

â”‚     â””â”€ ç›’å­èŒƒå›´: XÂ±1.0m, YÂ±3.5m, ZÂ±1.0m                        â”‚B-splineå¹³æ»‘ä¼˜åŒ– (5.97ms)

â”‚  2ï¸âƒ£ ConnectorèŠ‚ç‚¹é‡‡æ · (ä¸­é—´å¯†é›†åŒºåŸŸ)                             â”‚  â”œâ”€ Reboundæœºåˆ¶ (æœ€å¤š20æ¬¡é‡è¯•)

â”‚  3ï¸âƒ£ å¯è§æ€§å›¾æ„å»º (EDTè·ç¦»æ£€æµ‹ + æ¢¯åº¦æ£€æŸ¥)                         â”‚  â””â”€ å¤±è´¥â†’ä½¿ç”¨MPPIè½¨è¿¹

â”‚  4ï¸âƒ£ ä¸¤é˜¶æ®µDFSæœç´¢ (ç”Ÿæˆ300æ¡åŸå§‹è·¯å¾„)                            â”‚        â†“

â”‚  5ï¸âƒ£ Shortcutä¼˜åŒ– (visibility-based shortening)                 â”‚å‘å¸ƒè½¨è¿¹ (/planning/trajectory)

â”‚  6ï¸âƒ£ æ‹“æ‰‘æ£€æŸ¥ (åŒæ‹“æ‰‘è·¯å¾„å»é‡)                                    â”‚```

â”‚  7ï¸âƒ£ è¿­ä»£é€‰æ‹© (ratio_to_short=5.5, ä¿ç•™6æ¡æœ€ä¼˜)                  â”‚

â”‚                                                                 â”‚---

â”‚  å…³é”®å‚æ•°:                                                       â”‚

â”‚    - sample_num: 1000 (é‡‡æ ·ç‚¹æ•°é‡)                              â”‚## ğŸš€ æ ¸å¿ƒæ”¹è¿›

â”‚    - max_raw_path: 300 (DFSåŸå§‹è·¯å¾„æ•°)                          â”‚

â”‚    - max_select_path: 6 (æœ€ç»ˆè¾“å‡ºè·¯å¾„æ•°)                        â”‚### æ”¹è¿›0: Fast-Planner TopoPRM â­

â”‚    - ratio_to_short: 5.5 (è·¯å¾„é•¿åº¦å®¹å¿åº¦)                       â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜**æ–‡ä»¶**: `planner/path_searching/src/topo_prm.cpp`

                              â”‚

                              â–¼**æ ¸å¿ƒæ”¹è¿›**:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”- **Guard/Connectoré‡‡æ ·**: çŸ©å½¢ç›’å­(XÂ±1.0m, YÂ±3.5m, ZÂ±1.0m) æ›¿ä»£æ¤­çƒé‡‡æ ·

â”‚  LEVEL 2: MPPIéšæœºä¼˜åŒ– (Model Predictive Path Integral) ~3ms   â”‚- **Shortcutä¼˜åŒ–**: å¯è§æ€§æ£€æµ‹è·³è¿‡ä¸­é—´ç‚¹,è·¯å¾„é•¿åº¦å‡å°‘30%

â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤- **æ‹“æ‰‘æ£€æŸ¥**: åŒæ‹“æ‰‘è·¯å¾„å»é‡(ratio_to_short=5.5)

â”‚  è¾“å…¥: æ¯æ¡æ‹“æ‰‘è·¯å¾„ + start_vel, goal_vel                        â”‚- **HSVæ¸å˜å¯è§†åŒ–**: çº¢â†’å“çº¢â†’è“â†’é’â†’ç»¿â†’é»„,LINE_LISTæ¸²æŸ“

â”‚  æ–¹æ³•: åŠ æƒå¹³å‡é‡‡æ ·è½¨è¿¹ (information-theoretic framework)       â”‚- **å¹³æ»‘è·¯å¾„å¯è§†åŒ–**: è‡ªåŠ¨å¯†é›†åŒ–(<7ç‚¹) + 100Hz B-splineé‡‡æ ·

â”‚  è¾“å‡º: æ¯æ¡è·¯å¾„çš„æœ€ä¼˜å¹³æ»‘è½¨è¿¹ + cost                             â”‚

â”‚                                                                 â”‚**ROSè¯é¢˜**:

â”‚  ğŸ¯ MPPIæ ¸å¿ƒç®—æ³• (å‚è€ƒMPPI-Generic):                             â”‚- `/topo_paths`: åŸå§‹æ‹“æ‰‘è·¯å¾„ (å½©è™¹è‰², LINE_LIST)

â”‚                                                                 â”‚- `/topo_paths_smooth`: B-splineå¹³æ»‘è·¯å¾„ (LINE_STRIP)

â”‚  for each topo_path:  â† ä¸²è¡Œä¼˜åŒ–æ¯æ¡æ‹“æ‰‘è·¯å¾„                     â”‚

â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚**æ•ˆæœ**: è·¯å¾„æ¨ªå‘åˆ†æ•£Â±3.5m, æ‹“æ‰‘å¤šæ ·æ€§æ˜¾è‘—æå‡

â”‚    â”‚ STEP 1: é‡‡æ · (Sampling)                                 â”‚ â”‚

â”‚    â”‚   ç”Ÿæˆ500æ¡æ‰°åŠ¨è½¨è¿¹:                                     â”‚ â”‚---

â”‚    â”‚     u_i(t) = u_guide(t) + Îµ_i(t)                        â”‚ â”‚

â”‚    â”‚                                                         â”‚ â”‚### æ”¹è¿›1: éšœç¢ç‰©æƒé‡ 100â†’200

â”‚    â”‚   u_guide: æ‹“æ‰‘è·¯å¾„å¼•å¯¼çš„æ§åˆ¶åºåˆ—                        â”‚ â”‚

â”‚    â”‚   Îµ_i:     Colored Noise (æ—¶é—´ç›¸å…³, Î±=0.7)              â”‚ â”‚**æ–‡ä»¶**: \`planner/path_searching/src/mppi_planner.cpp\`

â”‚    â”‚                                                         â”‚ â”‚

â”‚    â”‚   ğŸš€ Colored Noiseç”Ÿæˆ (OUè¿‡ç¨‹):                        â”‚ â”‚\`\`\`cpp

â”‚    â”‚     Îµ[t] = Î±Â·Îµ[t-1] + âˆš(1-Î±Â²)Â·N(0,Î£)                   â”‚ â”‚// æ„é€ å‡½æ•°ä¸­

â”‚    â”‚     â””â”€ ä¿è¯æ—¶é—´å¹³æ»‘æ€§ (ç›¸é‚»æ—¶åˆ»ç›¸å…³)                     â”‚ â”‚w_obstacle_ = 200.0;  // åŸå€¼100.0

â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\`\`\`

â”‚                          â”‚                                      â”‚

â”‚                          â–¼                                      â”‚**æ•ˆæœ**: é¿éšœè·ç¦» 0.3mâ†’0.6m, ç¢°æ’ç‡ 30%â†’5%, æˆåŠŸç‡ 70%â†’85%

â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚

â”‚    â”‚ STEP 2: Rollout (åŠ¨åŠ›å­¦å‰å‘æ¨¡æ‹Ÿ)                        â”‚ â”‚---

â”‚    â”‚   for i = 1 to 500:  â† OpenMPå¹¶è¡Œ                       â”‚ â”‚

â”‚    â”‚     x_i[0] = start_pos, v_i[0] = start_vel              â”‚ â”‚### æ”¹è¿›2: MPPIå›é€€æœºåˆ¶

â”‚    â”‚     for t = 1 to horizon_steps (15æ­¥):                  â”‚ â”‚

â”‚    â”‚       a_i[t] = u_i[t]  â† ç®€åŒ–å››æ—‹ç¿¼æ¨¡å‹                 â”‚ â”‚**æ–‡ä»¶**: \`planner/plan_manage/src/planner_manager.cpp\`

â”‚    â”‚       v_i[t] = v_i[t-1] + a_i[t]Â·dt                     â”‚ â”‚

â”‚    â”‚       x_i[t] = x_i[t-1] + v_i[t]Â·dt                     â”‚ â”‚\`\`\`cpp

â”‚    â”‚                                                         â”‚ â”‚// B-splineå¤±è´¥æ—¶çš„å›é€€é€»è¾‘

â”‚    â”‚   ğŸ”’ çº¦æŸæ£€æŸ¥:                                           â”‚ â”‚if (!flag_step_1_success) {

â”‚    â”‚     |v| â‰¤ v_max (2.0 m/s)                               â”‚ â”‚    ROS_WARN("âš ï¸ B-spline failed - using MPPI trajectory as fallback");

â”‚    â”‚     |a| â‰¤ a_max (2.0 m/sÂ²)                              â”‚ â”‚    

â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    if (mppi_result_backup_.positions.size() >= 3) {

â”‚                          â”‚                                      â”‚        point_set = mppi_result_backup_.positions;

â”‚                          â–¼                                      â”‚        flag_step_1_success = true;  // æ ‡è®°å›é€€æˆåŠŸ

â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    }

â”‚    â”‚ STEP 3: Costè®¡ç®— (å¤šç›®æ ‡ä»£ä»·å‡½æ•°)                        â”‚ â”‚}

â”‚    â”‚   S(Ï„_i) = Î£_t [ cost(x_i[t], u_i[t]) ]                â”‚ â”‚\`\`\`

â”‚    â”‚                                                         â”‚ â”‚

â”‚    â”‚   cost = w_obsÂ·c_obs                â† éšœç¢ç‰©            â”‚ â”‚**æ•ˆæœ**: æˆåŠŸç‡ 85%â†’100%, B-splineå¤±è´¥ç‡21.4%æ—¶ä»èƒ½ç»§ç»­

â”‚    â”‚        + w_goalÂ·c_goal              â† ç›®æ ‡è·ç¦»          â”‚ â”‚

â”‚    â”‚        + w_smoothÂ·c_smooth          â† å¹³æ»‘æ€§            â”‚ â”‚---

â”‚    â”‚        + w_dynÂ·c_dynamic            â† åŠ¨æ€éšœç¢ç‰©        â”‚ â”‚

â”‚    â”‚                                                         â”‚ â”‚### æ”¹è¿›3: åŠ¨æ€éšœç¢ç‰©é¿è®©

â”‚    â”‚   ğŸ“ éšœç¢ç‰©ä»£ä»· (æŒ‡æ•°é€’å¢æƒ©ç½š):                          â”‚ â”‚

â”‚    â”‚     if dist < 0 (ç¢°æ’):                                 â”‚ â”‚**è®¢é˜…é¢„æµ‹** (\`planner/plan_env/src/grid_map.cpp\`):

â”‚    â”‚       collision_count++                                â”‚ â”‚\`\`\`cpp

â”‚    â”‚       cost += 1e5 Ã— 2^(collision_count-1)              â”‚ â”‚dynamic_pred_sub_ = node.subscribe(

â”‚    â”‚       ç¬¬1æ¬¡ç¢°æ’: +100k                                  â”‚ â”‚    "/dynamic_obstacles/predicted_paths", 

â”‚    â”‚       ç¬¬2æ¬¡ç¢°æ’: +200k                                  â”‚ â”‚    10, 

â”‚    â”‚       ç¬¬3æ¬¡ç¢°æ’: +400k                                  â”‚ â”‚    &GridMap::dynamicPredictionCallback, 

â”‚    â”‚       ç¬¬5+æ¬¡:   return 1e8 (ç›´æ¥æ”¾å¼ƒ)                   â”‚ â”‚    this

â”‚    â”‚                                                         â”‚ â”‚);

â”‚    â”‚   ğŸ¯ ç›®æ ‡ä»£ä»·:                                           â”‚ â”‚

â”‚    â”‚     c_goal = ||x_final - x_goal||Â²                     â”‚ â”‚// æ—¶é—´åŒæ­¥è·ç¦»æŸ¥è¯¢

â”‚    â”‚                                                         â”‚ â”‚double GridMap::getDynamicDistance(

â”‚    â”‚   ğŸŒŠ å¹³æ»‘ä»£ä»·:                                           â”‚ â”‚    const Eigen::Vector3d& pos, 

â”‚    â”‚     c_smooth = Î£ ||a[t]||Â² (åŠ é€Ÿåº¦å¹³æ–¹)                 â”‚ â”‚    double time_from_now

â”‚    â”‚                                                         â”‚ â”‚) {

â”‚    â”‚   ğŸ”® åŠ¨æ€éšœç¢ç‰©ä»£ä»·:                                     â”‚ â”‚    ros::Time query_time = ros::Time::now() + ros::Duration(time_from_now);

â”‚    â”‚     é¢„æµ‹tæ—¶åˆ»éšœç¢ç‰©ä½ç½® â†’ åŒæ ·æŒ‡æ•°æƒ©ç½š                   â”‚ â”‚    // åœ¨é¢„æµ‹è½¨è¿¹ä¸Šçº¿æ€§æ’å€¼

â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    return min_distance;

â”‚                          â”‚                                      â”‚}

â”‚                          â–¼                                      â”‚\`\`\`

â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚

â”‚    â”‚ STEP 4: æƒé‡è®¡ç®— (Information-Theoretic)                â”‚ â”‚**åŠ¨æ€æˆæœ¬** (\`planner/bspline_opt/src/bspline_optimizer.cpp\`):

â”‚    â”‚   w_i = exp(-S(Ï„_i) / Î») / Z                           â”‚ â”‚\`\`\`cpp

â”‚    â”‚                                                         â”‚ â”‚// æ§åˆ¶ç‚¹æ—¶é—´æ˜ å°„

â”‚    â”‚   Î»: æ¸©åº¦å‚æ•° (1.0) - æ§åˆ¶æ¢ç´¢vsåˆ©ç”¨                     â”‚ â”‚double time_from_now = (double)(i - order_) * dt;

â”‚    â”‚   Z: å½’ä¸€åŒ–å› å­ Î£_j exp(-S(Ï„_j) / Î»)                    â”‚ â”‚

â”‚    â”‚                                                         â”‚ â”‚// æŸ¥è¯¢æœªæ¥éšœç¢ç‰©è·ç¦»

â”‚    â”‚   ğŸ”¢ æ•°å€¼ç¨³å®šæŠ€å·§:                                       â”‚ â”‚double dynamic_dist = grid_map_->getDynamicDistance(pos, time_from_now);

â”‚    â”‚     S_min = min(S_1, ..., S_500)                        â”‚ â”‚

â”‚    â”‚     w_i = exp(-(S_i - S_min) / Î») / Z                   â”‚ â”‚// æˆæœ¬è®¡ç®—

â”‚    â”‚     â””â”€ é˜²æ­¢expæº¢å‡º                                       â”‚ â”‚if (dynamic_dist < 3.0 * cps_.clearance) {  // 1.5mé˜ˆå€¼

â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    cost += lambda_dynamic_ * pow(3.0*clearance - dynamic_dist, 2);

â”‚                          â”‚                                      â”‚}

â”‚                          â–¼                                      â”‚\`\`\`

â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚

â”‚    â”‚ STEP 5: åŠ æƒå¹³å‡ (Weighted Average)                     â”‚ â”‚**æ•ˆæœ**: æ”¯æŒ8éšœç¢ç‰©@30Hz, æå‰æ£€æµ‹ç‡87.5%(>2.0m), é›¶ç¢°æ’

â”‚    â”‚   x_opt[t] = Î£_i w_i Â· x_i[t]                           â”‚ â”‚

â”‚    â”‚   v_opt[t] = Î£_i w_i Â· v_i[t]                           â”‚ â”‚---

â”‚    â”‚   a_opt[t] = Î£_i w_i Â· a_i[t]                           â”‚ â”‚

â”‚    â”‚                                                         â”‚ â”‚### æ”¹è¿›4: Level 1 å¤šè·¯å¾„å¹¶è¡Œ

â”‚    â”‚   âœ¨ å…³é”®æ€æƒ³:                                           â”‚ â”‚

â”‚    â”‚   costä½çš„è½¨è¿¹æƒé‡å¤§ â†’ æœ€ç»ˆè½¨è¿¹è‡ªåŠ¨é¿å¼€éšœç¢ç‰©           â”‚ â”‚**æ–‡ä»¶**: \`planner/plan_manage/src/planner_manager.cpp\`

â”‚    â”‚   costé«˜çš„è½¨è¿¹æƒé‡å° â†’ ä½†ä»ä¿ç•™å°‘é‡æ¢ç´¢                 â”‚ â”‚

â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚\`\`\`cpp

â”‚                                                                 â”‚#include <omp.h>

â”‚  ğŸ† é€‰æ‹©æœ€ä¼˜è·¯å¾„:                                                â”‚

â”‚    normalized_cost = total_cost / path_length                  â”‚// å¹¶è¡Œä¼˜åŒ–æ‰€æœ‰æ‹“æ‰‘è·¯å¾„

â”‚    best_path = argmin(normalized_cost)                         â”‚mppi_candidates.resize(topo_paths.size());

â”‚                                                                 â”‚

â”‚  å…³é”®å‚æ•°:                                                       â”‚#pragma omp parallel for

â”‚    - num_samples: 500 (é‡‡æ ·æ•°é‡)                                â”‚for (size_t i = 0; i < topo_paths.size(); ++i) {

â”‚    - horizon_steps: 15 (é¢„æµ‹æ­¥æ•°)                               â”‚    mppi_planner_->planTrajectory(

â”‚    - dt: 0.1s (æ—¶é—´æ­¥é•¿)                                        â”‚        start_pt, current_vel, 

â”‚    - lambda: 1.0 (æ¸©åº¦å‚æ•°)                                     â”‚        local_target_pt, target_vel,

â”‚    - noise_std: [0.2, 0.5, 1.0] (xyzå™ªå£°å¼ºåº¦)                  â”‚        dense_path, 

â”‚    - alpha: 0.7 (Colored Noiseæ—¶é—´ç›¸å…³ç³»æ•°)                     â”‚        mppi_candidates[i].mppi_result

â”‚    - w_obstacle: 200.0 (éšœç¢ç‰©æƒé‡)                             â”‚    );

â”‚    - w_goal: 10.0 (ç›®æ ‡æƒé‡)                                    â”‚}

â”‚    - w_smooth: 50.0 (å¹³æ»‘æƒé‡)                                  â”‚\`\`\`

â”‚    - w_dynamic: 20.0 (åŠ¨æ€éšœç¢ç‰©æƒé‡)                           â”‚

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜**CMakeé…ç½®**:

                              â”‚\`\`\`cmake

                              â–¼find_package(OpenMP REQUIRED)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”target_compile_options(ego_planner_node PRIVATE \${OpenMP_CXX_FLAGS})

â”‚  LEVEL 3: B-splineå¹³æ»‘ (Rebound Optimizer)           ~6ms      â”‚target_link_libraries(ego_planner_node \${OpenMP_CXX_LIBRARIES})

â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤\`\`\`

â”‚  è¾“å…¥: MPPIæœ€ä¼˜è½¨è¿¹æ§åˆ¶ç‚¹                                        â”‚

â”‚  æ–¹æ³•: æ¢¯åº¦ä¸‹é™ä¼˜åŒ– + Reboundæœºåˆ¶                                â”‚**æ•ˆæœ**: 6è·¯å¾„ä¼˜åŒ– 23msâ†’18ms

â”‚  è¾“å‡º: æœ€ç»ˆå¯æ‰§è¡Œçš„å¹³æ»‘B-splineè½¨è¿¹                              â”‚

â”‚                                                                 â”‚---

â”‚  ä¼˜åŒ–ç›®æ ‡:                                                       â”‚

â”‚    min J = J_smoothness + J_distance + J_feasibility + J_time  â”‚### æ”¹è¿›5: Level 2 é‡‡æ ·å¹¶è¡Œ

â”‚                                                                 â”‚

â”‚  å¤±è´¥å¤„ç†:                                                       â”‚**æ–‡ä»¶**: \`planner/path_searching/src/mppi_planner.cpp\`

â”‚    if rebound > 20æ¬¡:                                           â”‚

â”‚      è¿”å›MPPIè½¨è¿¹ (å·²ç»è¶³å¤Ÿå¥½)                                   â”‚\`\`\`cpp

â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜#include <omp.h>

                              â”‚

                              â–¼void MPPIPlanner::optimizePath(...) {

                    âœ… å‘å¸ƒæœ€ç»ˆè½¨è¿¹    int adaptive_samples = 1000;

```    

    #pragma omp parallel

---    {

        // çº¿ç¨‹å®‰å…¨: æ¯çº¿ç¨‹ç‹¬ç«‹éšæœºæ•°ç”Ÿæˆå™¨

## ğŸ¯ MPPIç®—æ³•è¯¦è§£        std::mt19937 local_gen(generator_() + omp_get_thread_num());

        std::normal_distribution<double> local_dist(0.0, 1.0);

### ä¸ºä»€ä¹ˆéœ€è¦MPPI?        

        double min_cost = std::numeric_limits<double>::max();

æ‹“æ‰‘è·¯å¾„è§„åˆ’(TopoPRM)è™½ç„¶èƒ½æ‰¾åˆ°å…¨å±€å¤šæ¡è·¯å¾„,ä½†å­˜åœ¨é—®é¢˜:        

1. **å‡ ä½•è·¯å¾„ä¸å¹³æ»‘** - ç”±é‡‡æ ·ç‚¹è¿æ¥è€Œæˆ,è½¬è§’å°–é”        #pragma omp for reduction(min:min_cost)

2. **ä¸è€ƒè™‘åŠ¨åŠ›å­¦** - æ²¡æœ‰é€Ÿåº¦/åŠ é€Ÿåº¦çº¦æŸ        for (int i = 0; i < adaptive_samples; ++i) {

3. **æ— æ—¶é—´ä¿¡æ¯** - åªæœ‰ç©ºé—´è·¯å¾„,æ²¡æœ‰æ—¶é—´åˆ†é…            // ä½¿ç”¨å±€éƒ¨RNGç”Ÿæˆæ‰°åŠ¨

4. **å±€éƒ¨ä¼˜åŒ–ä¸è¶³** - å¯èƒ½ç»•è¿œè·¯æˆ–é è¿‘éšœç¢ç‰©            rolloutTrajectory(start_pos, start_vel, goal_pos, goal_vel,

                             trajectories[i], local_gen, local_dist);

MPPIé€šè¿‡**éšæœºé‡‡æ ·+åŠ æƒå¹³å‡**è§£å†³è¿™äº›é—®é¢˜:            

- ç”Ÿæˆå¹³æ»‘çš„åŠ¨åŠ›å­¦å¯è¡Œè½¨è¿¹            double cost = calculateTrajectoryCost(trajectories[i], start_vel);

- è‡ªåŠ¨å¹³è¡¡å¤šä¸ªç›®æ ‡(é¿éšœã€åˆ°è¾¾ç›®æ ‡ã€å¹³æ»‘æ€§)            trajectories[i].cost = cost;

- æä¾›æ—¶é—´æœ€ä¼˜è§£            

            if (cost < min_cost) min_cost = cost;

### MPPI vs ä¼ ç»Ÿä¼˜åŒ–        }

    }

| ç‰¹æ€§ | ä¼ ç»Ÿæ¢¯åº¦ä¼˜åŒ– | MPPIéšæœºä¼˜åŒ– |    

|------|-------------|-------------|    // åŠ æƒå¹³å‡ (ä¸²è¡Œ)

| å±€éƒ¨æœ€ä¼˜ | âŒ å®¹æ˜“é™·å…¥ | âœ… æ¦‚ç‡é€ƒé€¸ |    computeWeightedAverage(trajectories, optimal_trajectory);

| éå‡¸é—®é¢˜ | âŒ éš¾å¤„ç† | âœ… æ“…é•¿ |}

| å®æ—¶æ€§ | âš ï¸ ä¸ç¨³å®š | âœ… å¹¶è¡Œå¿« |\`\`\`

| æ¢¯åº¦éœ€æ±‚ | âŒ éœ€è¦ | âœ… æ— éœ€ |

| å¤šæ¨¡æ€ | âŒ å•è§£ | âœ… è‡ªç„¶å¤„ç† |**å…³é”®æŠ€æœ¯**:

- çº¿ç¨‹å®‰å…¨RNG: \`local_gen\` ç§å­ = \`generator_() + thread_id\`

### MPPIæ ¸å¿ƒæ€æƒ³ (Information-Theoretic)- OpenMPå½’çº¦: \`reduction(min:min_cost)\`

- å‡½æ•°é‡è½½: æ–°å¢æ¥å—å±€éƒ¨RNGçš„ \`rolloutTrajectory()\` ç‰ˆæœ¬

**é—®é¢˜**: ç»™å®šåˆå§‹çŠ¶æ€å’Œç›®æ ‡,æ‰¾æœ€ä¼˜æ§åˆ¶åºåˆ— u*

**CMakeé…ç½®**:

**ä¼ ç»Ÿæ–¹æ³•**: æ¢¯åº¦ä¸‹é™ â†’ å®¹æ˜“å±€éƒ¨æœ€ä¼˜\`\`\`cmake

find_package(OpenMP REQUIRED)

**MPPIæ–¹æ³•**: target_compile_options(path_searching PRIVATE \${OpenMP_CXX_FLAGS})

1. ä»å½“å‰æ§åˆ¶ u é™„è¿‘éšæœºé‡‡æ · N ä¸ªæ‰°åŠ¨æ§åˆ¶ u_itarget_link_libraries(path_searching \${OpenMP_CXX_LIBRARIES})

2. å‰å‘æ¨¡æ‹Ÿå¾—åˆ° N æ¡è½¨è¿¹ Ï„_i\`\`\`

3. è®¡ç®—æ¯æ¡è½¨è¿¹çš„ cost S(Ï„_i)

4. ç”¨ Boltzmann åˆ†å¸ƒåŠ æƒ: w_i = exp(-S(Ï„_i)/Î»)**æ•ˆæœ**: 18msâ†’7.48ms (500é‡‡æ ·), æœ€ç»ˆ10.85ms (1000é‡‡æ ·), 3.44å€åŠ é€Ÿ

5. åŠ æƒå¹³å‡å¾—æ–°æ§åˆ¶: u* = Î£ w_i Â· u_i

---

**å…³é”®**: cost ä½çš„è½¨è¿¹æƒé‡å¤§,è‡ªåŠ¨é›†ä¸­åœ¨å¥½çš„åŒºåŸŸ!

### æ”¹è¿›6: MPPIå¤šè·¯å¾„å¯è§†åŒ–

### æ•°å­¦æ¨å¯¼ (ç®€åŒ–ç‰ˆ)

**åŠŸèƒ½**: ä¿å­˜å¹¶å¯è§†åŒ–æ‰€æœ‰MPPIä¼˜åŒ–åçš„å€™é€‰è·¯å¾„ï¼ˆ4-6æ¡ï¼‰ï¼Œè€Œéä»…æœ€ä¼˜è·¯å¾„

MPPIæºäº**éšæœºæœ€ä¼˜æ§åˆ¶**ç†è®º:

**æ–‡ä»¶**: `planner/plan_manage/include/plan_manage/planner_manager.h`

```

æœ€ä¼˜æ§åˆ¶é—®é¢˜:```cpp

  u* = argmin E[S(Ï„)]/* ğŸ¨ å¤šè·¯å¾„å¯è§†åŒ–æ•°æ®ç»“æ„ */

  struct MPPIPathCandidate {

å…¶ä¸­ S(Ï„) = âˆ« cost(x(t), u(t)) dt    std::vector<Eigen::Vector3d> positions;  // è·¯å¾„ç‚¹

    double cost;                              // åŸå§‹ä»£ä»·

MPPIè¿‘ä¼¼è§£:    double normalized_cost;                   // å½’ä¸€åŒ–ä»£ä»·ï¼ˆcost/lengthï¼‰

  u* â‰ˆ Î£_i w_i Â· u_i    bool is_best;                             // æ˜¯å¦ä¸ºæœ€ä¼˜è·¯å¾„

      bool success;                             // MPPIä¼˜åŒ–æ˜¯å¦æˆåŠŸ

  w_i = exp(-S(Ï„_i) / Î») / Z};

  

  Z = Î£_j exp(-S(Ï„_j) / Î»)  (å½’ä¸€åŒ–)/* è·å–æ‰€æœ‰MPPIä¼˜åŒ–è·¯å¾„ */

```const std::vector<MPPIPathCandidate>& getAllMPPIPaths() const;

```

è¿™ä¸ªå…¬å¼æ¥è‡ª**è·¯å¾„ç§¯åˆ†æ§åˆ¶**(Path Integral Control)ç†è®º,

å°†Hamilton-Jacobi-Bellmanæ–¹ç¨‹è½¬åŒ–ä¸ºæœŸæœ›è®¡ç®—ã€‚**ä½¿ç”¨æ–¹æ³•**:

```cpp

### æ¨¡å—åŒ–è®¾è®¡ (MPPI-Generic)// åœ¨FSMèŠ‚ç‚¹ä¸­è®¿é—®æ‰€æœ‰è·¯å¾„

const auto& all_paths = planner_manager_->getAllMPPIPaths();

æœ¬é¡¹ç›®å‚è€ƒäº†MPPI-Genericçš„æ¨¡å—åŒ–æ¶æ„:

for (size_t i = 0; i < all_paths.size(); ++i) {

```cpp    if (all_paths[i].is_best) {

// åŠ¨åŠ›å­¦æ¨¡å‹ (å¯æ›¿æ¢)        // æœ€ä¼˜è·¯å¾„: å¯è§†åŒ–ä¸ºé‡‘è‰²ç²—çº¿

class MPPIDynamics {    } else if (all_paths[i].success) {

    void step(State& s, Control u, double dt);        // å…¶ä»–æˆåŠŸè·¯å¾„: å½©è‰²ç»†çº¿

    bool isValid(State s);    }

};}

```

// ä»£ä»·å‡½æ•° (å¯è‡ªå®šä¹‰)

class MPPICost {**æ•ˆæœ**: 

    double computeRunningCost(State s, Control u);- **RVizå¯è§†åŒ–**: `/all_mppi_candidate_paths` è¯é¢˜

    double computeObstacleCost(Vector3d pos);  - é‡‘è‰²ç²—çº¿ (0.15m) = æœ€ä¼˜è·¯å¾„ â˜…

    double computeGoalCost(Vector3d pos, Vector3d goal);  - å½©è™¹è‰²ç»†çº¿ (0.08m) = å…¶ä»–æˆåŠŸè·¯å¾„

};  - åŠé€æ˜çº¢çº¿ (0.05m) = å¤±è´¥è·¯å¾„

- **è·¯å¾„æ ‡ç­¾**: æ˜¾ç¤ºè·¯å¾„ç¼–å·å’Œå½’ä¸€åŒ–ä»£ä»·

// é‡‡æ ·ç­–ç•¥ (å¯æ‰©å±•)- æ— é¢å¤–è®¡ç®—å¼€é”€ï¼ˆåªä¿å­˜å·²æœ‰æ•°æ®ï¼‰

class MPPISampling {- å†…å­˜å¼€é”€: ~50KB/æ¬¡è§„åˆ’

    Control sampleNoise(int step);  // Colored Noise

    void setSeed(int seed);**RVizé…ç½®**: `map_manager/rviz/map.rviz` å·²æ·»åŠ  `MPPI_Candidate_Paths` æ˜¾ç¤ºé¡¹

};

---

// ä¸»è§„åˆ’å™¨

class MPPIPlanner {### æ”¹è¿›7: é‡‡æ ·æ•°æå‡ 500â†’1000

    MPPIDynamics dynamics_;

    MPPICost cost_;**æ–‡ä»¶**: \`planner/path_searching/src/mppi_planner.cpp\`

    MPPISampling sampling_;

    \`\`\`cpp

    bool planTrajectory(...);MPPIPlanner::MPPIPlanner() : 

};    num_samples_(1000),       // ä»500å¢åŠ 

```    num_samples_min_(1000),

    num_samples_max_(2000)    // è‡ªé€‚åº”ä¸Šé™

**ä¼˜åŠ¿**:{

- æ˜“äºæ‰©å±•ä¸åŒåŠ¨åŠ›å­¦æ¨¡å‹ (å››æ—‹ç¿¼/å›ºå®šç¿¼/åœ°é¢è½¦)    // ...

- è‡ªå®šä¹‰ä»£ä»·å‡½æ•°}

- æ›¿æ¢é‡‡æ ·ç­–ç•¥ (ç™½å™ªå£°/Colored Noise/Importance Sampling)\`\`\`



### Colored Noise vs ç™½å™ªå£°**æ•ˆæœ**: 

- æ—¶é—´: 7.48msâ†’10.85ms (+3.37ms)

**ç™½å™ªå£°** (ä¼ ç»ŸMPPI):- è´¨é‡: å¹³å‡æˆæœ¬é™ä½, æ¢ç´¢æ›´å……åˆ†

```- ä»æ»¡è¶³: 10.85ms << 20mså®æ—¶è¦æ±‚

Îµ[t] ~ N(0, Î£)  â† æ¯ä¸ªæ—¶åˆ»ç‹¬ç«‹é‡‡æ ·

```---

é—®é¢˜: è½¨è¿¹æŠ–åŠ¨ä¸¥é‡,ä¸å¹³æ»‘

## ğŸ“Š æ€§èƒ½æ•°æ®

**Colored Noise** (æœ¬é¡¹ç›®):

```### å®æ—¶æ€§

Îµ[t] = Î±Â·Îµ[t-1] + âˆš(1-Î±Â²)Â·N(0, Î£)| æ¨¡å— | è€—æ—¶ | å æ¯” |

```|------|------|------|

- Î±=0.7: æ—¶é—´ç›¸å…³ç³»æ•°| TopoPRM | <1ms | 5% |

- å‰ä¸€æ—¶åˆ»çš„å™ªå£°å½±å“å½“å‰æ—¶åˆ»| MPPIä¼˜åŒ– | 10.85ms | 65% |

- ç»“æœ: æ‰°åŠ¨è½¨è¿¹æ›´å¹³æ»‘,æ›´ç¬¦åˆåŠ¨åŠ›å­¦çº¦æŸ| B-spline | 5.97ms | 35% |

| **æ€»è®¡** | **~17ms** | **100%** |

### è‡ªé€‚åº”é‡‡æ ·

### åŠ é€Ÿæ•ˆæœ

æ ¹æ®ç¯å¢ƒå¤æ‚åº¦åŠ¨æ€è°ƒæ•´é‡‡æ ·æ•°:| ä¼˜åŒ–çº§åˆ« | æ—¶é—´ | vsä¸²è¡Œ |

|----------|------|--------|

```cpp| Level 0 (ä¸²è¡ŒåŸºå‡†) | ~26ms | 1.0x |

// ç®€å•ç¯å¢ƒ â†’ å°‘é‡‡æ · (300)| Level 1 (å¤šè·¯å¾„å¹¶è¡Œ) | 23ms | 1.13x |

// å¤æ‚ç¯å¢ƒ â†’ å¤šé‡‡æ · (800)| Level 2 (500é‡‡æ ·) | 7.48ms | 3.44x |

| **Level 3 (1000é‡‡æ ·)** | **10.85ms** | **2.39x** |

int adaptive_samples = num_samples_;

if (obstacle_density > threshold) {### æˆåŠŸç‡

    adaptive_samples = num_samples_max_;  // 800- é‡è§„åˆ’: 28-36æ¬¡

} else {- æˆåŠŸ: 28-36æ¬¡

    adaptive_samples = num_samples_min_;  // 300- **æˆåŠŸç‡: 100%**

}- MPPIé”™è¯¯: 0

```- B-splineå›é€€: 6æ¬¡(21.4%), å…¨éƒ¨æˆåŠŸ



**æ•ˆæœ**: ç®€å•åœºæ™¯åŠ é€Ÿ,å¤æ‚åœºæ™¯ä¿è¯æˆåŠŸç‡### åŠ¨æ€é¿éšœ

- é¢„æµ‹é¢‘ç‡: 30Hz

### GPUåŠ é€Ÿæ½œåŠ›- éšœç¢ç‰©æ•°: 8ä¸ª

- é¢„æµ‹æ—¶é•¿: 0.5ç§’ (50ç‚¹Ã—0.01s)

MPPIå¤©ç„¶é€‚åˆGPUå¹¶è¡Œ:- æ£€æµ‹è·ç¦»: 1.27m-4.21m

- æå‰æ£€æµ‹: 87.5% (>2.0m)

```- ç¢°æ’: 0æ¬¡

CPUç‰ˆæœ¬:

  500 samples Ã— 15 steps = 7500æ¬¡è®¡ç®—---

  OpenMPå¤šçº¿ç¨‹ ~3ms

## ğŸ’» å¿«é€Ÿå¼€å§‹

GPUç‰ˆæœ¬ (å·²å®ç°ä½†æœªå¯ç”¨):

  7500æ¬¡è®¡ç®— â†’ 7500ä¸ªCUDAçº¿ç¨‹### 1. å®‰è£…ä¾èµ–

  ç†è®ºåŠ é€Ÿ: 10-50x â†’ 0.1-0.5ms\`\`\`bash

```sudo apt-get install -y \\

    ros-noetic-cv-bridge \\

**å½“å‰çŠ¶æ€**: GPUæ ¸å¿ƒç®—æ³•100%å®Œæˆ,EDTä¼ é€’å¾…è°ƒè¯•    ros-noetic-pcl-ros \\

    ros-noetic-vision-msgs \\

---    libomp-dev

\`\`\`

## ğŸ“Š æ€§èƒ½æ•°æ®

### 2. ç¼–è¯‘

### å®é™…æµ‹è¯•ç»“æœ\`\`\`bash

cd ~/catkin_ws

```catkin_make -DCMAKE_BUILD_TYPE=Release

æµ‹è¯•ç¯å¢ƒ: Docker + RTX 5070 + ROS Noetic\`\`\`

åœ°å›¾: 40Ã—20Ã—3m å¤æ‚éšœç¢ç‰©ç¯å¢ƒ

ä»»åŠ¡: 28-36æ¬¡é‡è§„åˆ’### 3. è¿è¡Œ

\`\`\`bash

ç»“æœ:# ç»ˆç«¯1: ä»¿çœŸç¯å¢ƒ

  âœ… æˆåŠŸç‡: 100% (300/300æœ‰æ•ˆè½¨è¿¹)roslaunch uav_simulator start.launch

  âš¡ MPPIæ—¶é—´: ~3ms (å¹³å‡)

  ğŸ¯ CostèŒƒå›´: 1744-2306 (æ­£å¸¸)# ç»ˆç«¯2: è§„åˆ’å™¨

  ğŸš€ æ— äººæœº: å¹³æ»‘è¿åŠ¨,æ— ç¢°æ’roslaunch plan_manage run_in_sim.launch

```

# ç»ˆç«¯3: RViz

### æ€§èƒ½å¯¹æ¯”roslaunch map_manager rviz.launch

\`\`\`

| æ–¹æ³• | æˆåŠŸç‡ | è§„åˆ’æ—¶é—´ | è½¨è¿¹è´¨é‡ |

|------|--------|---------|---------|---

| çº¯Topo | 90% | <1ms | ä¸­ç­‰ (å‡ ä½•è·¯å¾„) |

| **Topo+MPPI** | **100%** | **~3ms** | **ä¼˜ç§€ (åŠ¨åŠ›å­¦è½¨è¿¹)** |## âš™ï¸ å…³é”®å‚æ•°

| Topo+MPPI+GPU | 100% | ~0.5ms (é¢„æœŸ) | ä¼˜ç§€ |

### MPPI (\`mppi_config.yaml\`)

---\`\`\`yaml

num_samples: 1000        # é‡‡æ ·æ•°

## ğŸš€ å¿«é€Ÿå¼€å§‹horizon_steps: 20        # é¢„æµ‹æ­¥æ•°

horizon_length: 2.0      # é¢„æµ‹æ—¶é•¿(ç§’)

### ç¼–è¯‘w_obstacle: 200.0        # éšœç¢ç‰©æƒé‡

w_dynamic: 1.5           # åŠ¨æ€éšœç¢ç‰©æƒé‡

```bashw_smoothness: 10.0       # å¹³æ»‘æ€§

cd ~/ros_ws/ddo-topo-mppiw_goal: 50.0             # ç›®æ ‡å¸å¼•

catkin_makew_velocity: 20.0         # é€Ÿåº¦è·Ÿè¸ª

source devel/setup.bash\`\`\`

```

### B-spline (\`bspline_config.yaml\`)

### è¿è¡Œä»¿çœŸ\`\`\`yaml

max_vel: 2.0             # æœ€å¤§é€Ÿåº¦ (m/s)

**ç»ˆç«¯1**: å¯åŠ¨è§„åˆ’èŠ‚ç‚¹max_acc: 5.0             # æœ€å¤§åŠ é€Ÿåº¦ (m/sÂ²)

```bashclearance: 0.5           # å®‰å…¨è·ç¦» (m)

docker exec -it <container_id> bash -c "lambda_smooth: 0.01      # å¹³æ»‘æƒé‡

  cd /home/developer/ros_ws/ddo-topo-mppi && \lambda_collision: 100.0  # ç¢°æ’æƒ©ç½š

  source devel/setup.bash && \\`\`\`

  roslaunch plan_manage topo_mppi_fastplanner_map.launch

"### åŠ¨æ€é¢„æµ‹ (\`dynamic_map_param.yaml\`)

```\`\`\`yaml

prediction_duration: 0.5       # é¢„æµ‹æ—¶é•¿(ç§’)

**ç»ˆç«¯2**: å¯åŠ¨RVizå¯è§†åŒ–prediction_resolution: 0.01    # åˆ†è¾¨ç‡(ç§’)

```bashdynamic_clearance_ratio: 1.5   # åŠ¨æ€å®‰å…¨å€æ•°

docker exec -e DISPLAY=$DISPLAY <container_id> bash -c "\`\`\`

  source /home/developer/ros_ws/ddo-topo-mppi/devel/setup.bash && \

  rviz -d src/planner/plan_manage/launch/fastplanner_test.rviz---

"

```## ğŸ”§ æ•…éšœæ’æŸ¥



### RVizå¯è§†åŒ–è¯´æ˜### é—®é¢˜1: è§„åˆ’å¤±è´¥ç‡é«˜



- **ç»¿è‰²è·¯å¾„**: æ‹“æ‰‘è·¯å¾„å€™é€‰é›†**ç—‡çŠ¶**: "No feasible path found"

- **å½©è‰²è½¨è¿¹**: MPPIä¼˜åŒ–åçš„å¤šæ¡è½¨è¿¹

  - ğŸŸ¢ ç»¿è‰²ç²—çº¿: æœ€ä¼˜è½¨è¿¹**è§£å†³**:

  - ğŸ”µ è“è‰²ç»†çº¿: æ¬¡ä¼˜è½¨è¿¹\`\`\`yaml

  - ğŸ”´ çº¢è‰²ç»†çº¿: å¤±è´¥è½¨è¿¹# é™ä½éšœç¢ç‰©æƒé‡

- **çº¢è‰²æ›²çº¿**: æœ€ç»ˆB-splineå¹³æ»‘è½¨è¿¹w_obstacle: 200.0 â†’ 150.0

- **çº¢è‰²æ–¹å—**: åŠ¨æ€éšœç¢ç‰©

- **è“è‰²çƒ**: éšœç¢ç‰©é¢„æµ‹ä½ç½®# æ”¾å®½å®‰å…¨è·ç¦»

clearance: 0.5 â†’ 0.3

---\`\`\`



## ğŸ“ ä»£ç ç»“æ„---



```### é—®é¢˜2: MPPIæ—¶é—´è¿‡é•¿

src/

â”œâ”€â”€ planner/**ç—‡çŠ¶**: MPPI > 20ms

â”‚   â”œâ”€â”€ path_searching/          # è·¯å¾„æœç´¢ç®—æ³•

â”‚   â”‚   â”œâ”€â”€ include/path_searching/**æ£€æŸ¥OpenMP**:

â”‚   â”‚   â”‚   â”œâ”€â”€ topo_prm.h       # æ‹“æ‰‘PRMè§„åˆ’å™¨\`\`\`bash

â”‚   â”‚   â”‚   â”œâ”€â”€ mppi_planner.h   # MPPIä¸»è§„åˆ’å™¨grep -r "OpenMP" build/path_searching/CMakeFiles/*/flags.make

â”‚   â”‚   â”‚   â”œâ”€â”€ mppi_dynamics.h  # åŠ¨åŠ›å­¦æ¨¡å‹# åº”è¯¥åŒ…å«: -fopenmp

â”‚   â”‚   â”‚   â”œâ”€â”€ mppi_cost.h      # ä»£ä»·å‡½æ•°\`\`\`

â”‚   â”‚   â”‚   â”œâ”€â”€ mppi_sampling.h  # é‡‡æ ·ç­–ç•¥

â”‚   â”‚   â”‚   â””â”€â”€ mppi_gpu.h       # GPUåŠ é€Ÿæ¥å£**é™ä½é‡‡æ ·**:

â”‚   â”‚   â””â”€â”€ src/\`\`\`yaml

â”‚   â”‚       â”œâ”€â”€ topo_prm.cppnum_samples: 1000 â†’ 800

â”‚   â”‚       â”œâ”€â”€ mppi_planner.cpp # æ ¸å¿ƒMPPIç®—æ³•(1134è¡Œ)\`\`\`

â”‚   â”‚       â””â”€â”€ mppi_gpu.cu      # CUDA kernelå®ç°

â”‚   â”‚---

â”‚   â”œâ”€â”€ bspline_opt/             # B-splineä¼˜åŒ–

â”‚   â”‚   â””â”€â”€ src/bspline_optimizer.cpp### é—®é¢˜3: åŠ¨æ€éšœç¢ç‰©ä¸å·¥ä½œ

â”‚   â”‚

â”‚   â”œâ”€â”€ plan_manage/             # è§„åˆ’ç®¡ç†å™¨**ç—‡çŠ¶**: "âš ï¸ No dynamic predictions"

â”‚   â”‚   â””â”€â”€ src/planner_manager.cpp  # ä¸‰çº§æ¶æ„åè°ƒ(1184è¡Œ)

â”‚   â”‚**è¯Šæ–­**:

â”‚   â””â”€â”€ plan_env/                # ç¯å¢ƒæ¨¡å—\`\`\`bash

â”‚       â””â”€â”€ src/grid_map.cpp     # EDTåœ°å›¾# æ£€æŸ¥è¯é¢˜é¢‘ç‡

â”‚rostopic hz /dynamic_obstacles/predicted_paths

â”œâ”€â”€ map_manager/                 # åœ°å›¾ç®¡ç†# åº”è¯¥ ~30Hz

â”œâ”€â”€ onboard_detector/            # éšœç¢ç‰©æ£€æµ‹

â””â”€â”€ uav_simulator/               # æ— äººæœºä»¿çœŸ# æ£€æŸ¥è®¢é˜…

```rostopic info /dynamic_obstacles/predicted_paths

# åº”è¯¥æ˜¾ç¤º ego_planner_node

### æ ¸å¿ƒæ–‡ä»¶è¯´æ˜\`\`\`



**planner_manager.cpp** (1184è¡Œ):**è§£å†³**:

- åè°ƒä¸‰çº§è§„åˆ’æµç¨‹\`\`\`bash

- å¤šè·¯å¾„MPPIå¹¶è¡Œä¼˜åŒ–roslaunch map_generator dynamic_obstacles.launch

- è½¨è¿¹å¯è§†åŒ–å‘å¸ƒ\`\`\`



**mppi_planner.cpp** (1134è¡Œ):---

- MPPIæ ¸å¿ƒç®—æ³•å®ç°

- Colored Noiseé‡‡æ ·## ğŸ“š å¼•ç”¨

- åŠ¨åŠ›å­¦rollout

- åŠ æƒå¹³å‡è®¡ç®—### FastPlanner

- GPUæ¥å£é›†æˆ\`\`\`bibtex

@article{zhou2020robust,

**mppi_cost.h** (182è¡Œ):  title={Robust and efficient quadrotor trajectory generation},

- éšœç¢ç‰©ä»£ä»· (æŒ‡æ•°æƒ©ç½š)  author={Zhou, Boyu and Gao, Fei and Wang, Luqi and ...},

- ç›®æ ‡ä»£ä»·  journal={IEEE RA-L},

- å¹³æ»‘ä»£ä»·  year={2019}

- åŠ¨æ€éšœç¢ç‰©ä»£ä»·}

\`\`\`

**mppi_dynamics.h** (76è¡Œ):

- ç®€åŒ–å››æ—‹ç¿¼æ¨¡å‹### MPPI-Generic

- åŠ¨åŠ›å­¦çº¦æŸæ£€æŸ¥- GitHub: [ACDSLab/MPPI-Generic](https://github.com/ACDSLab/MPPI-Generic)



**mppi_sampling.h** (86è¡Œ):### åŠ¨æ€æ£€æµ‹

- Colored Noiseç”Ÿæˆ\`\`\`bibtex

- çº¿ç¨‹å®‰å…¨RNG@article{xu2023onboard,

  title={Onboard dynamic-object detection and tracking},

---  author={Xu, Zhefan and Zhan, Xiaoyang and ...},

  journal={IEEE RA-L},

## âš™ï¸ å…³é”®å‚æ•°  year={2023}

}

### MPPIå‚æ•°\`\`\`



ä½ç½®: `planner/path_searching/src/mppi_planner.cpp`---



```cpp**æ›´æ–°**: 2025-01-13  

// é‡‡æ ·å‚æ•°**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª

num_samples_: 500           // åŸºç¡€é‡‡æ ·æ•°
num_samples_min_: 300       // è‡ªé€‚åº”æœ€å°å€¼
num_samples_max_: 800       // è‡ªé€‚åº”æœ€å¤§å€¼

// é¢„æµ‹å‚æ•°
horizon_steps_: 15          // é¢„æµ‹æ­¥æ•°
dt_: 0.1                    // æ—¶é—´æ­¥é•¿ (ç§’)

// æ¸©åº¦å‚æ•°
lambda_: 1.0                // æ¸©åº¦ (è¶Šå°è¶Šè´ªå©ª)

// å™ªå£°å‚æ•°
noise_std_: [0.2, 0.5, 1.0] // xyzå™ªå£°æ ‡å‡†å·®
alpha_: 0.7                 // Colored Noiseæ—¶é—´ç›¸å…³

// ä»£ä»·æƒé‡
w_obstacle_: 200.0          // éšœç¢ç‰©
w_goal_: 10.0               // ç›®æ ‡
w_smooth_: 50.0             // å¹³æ»‘
w_dynamic_: 20.0            // åŠ¨æ€éšœç¢ç‰©

// çº¦æŸ
v_max_: 2.0                 // æœ€å¤§é€Ÿåº¦ m/s
a_max_: 2.0                 // æœ€å¤§åŠ é€Ÿåº¦ m/sÂ²
safe_distance_: 0.3         // å®‰å…¨è·ç¦» m
```

### æ‹“æ‰‘è§„åˆ’å‚æ•°

ä½ç½®: `planner/path_searching/src/topo_prm.cpp`

```cpp
sample_num_: 1000           // PRMé‡‡æ ·ç‚¹æ•°
max_raw_path_: 300          // DFSæœ€å¤§è·¯å¾„æ•°
max_select_path_: 6         // æœ€ç»ˆä¿ç•™è·¯å¾„æ•°
ratio_to_short_: 5.5        // é•¿åº¦å®¹å¿æ¯”ä¾‹
```

### è°ƒå‚å»ºè®®

**æé«˜æˆåŠŸç‡**:
- å¢åŠ  `num_samples_` (500â†’800)
- å¢åŠ  `w_obstacle_` (200â†’300)
- å¢åŠ  `safe_distance_` (0.3â†’0.5)

**æé«˜é€Ÿåº¦**:
- å‡å°‘ `num_samples_` (500â†’300)
- å‡å°‘ `horizon_steps_` (15â†’10)
- å‡å°‘ `max_select_path_` (6â†’3)

**æé«˜å¹³æ»‘æ€§**:
- å¢åŠ  `w_smooth_` (50â†’100)
- å¢åŠ  `alpha_` (0.7â†’0.9)

---

## ğŸ”¬ æŠ€æœ¯äº®ç‚¹

### 1ï¸âƒ£ ä¸‰çº§æ¶æ„è®¾è®¡

```
å…¨å±€æ‹“æ‰‘ â†’ å±€éƒ¨ä¼˜åŒ– â†’ å¹³æ»‘ç»†åŒ–
  â†‘          â†‘          â†‘
é¿å…å±€éƒ¨æœ€ä¼˜ åŠ¨åŠ›å­¦å¯è¡Œ æ‰§è¡Œè´¨é‡
```

æ¯ä¸€çº§ä¸“æ³¨è‡ªå·±çš„èŒè´£,åˆ†å·¥æ˜ç¡®ã€‚

### 2ï¸âƒ£ MPPIéšæœºä¼˜åŒ–

- åŸºäº**ä¿¡æ¯è®º**çš„ç†è®ºæ¡†æ¶
- è‡ªç„¶å¤„ç†**éå‡¸**ä¼˜åŒ–é—®é¢˜
- **æ— éœ€æ¢¯åº¦**,é€‚åˆå¤æ‚ç¯å¢ƒ
- å¤©ç„¶**å¹¶è¡Œ**,GPUåŠ é€Ÿæ½œåŠ›å¤§

### 3ï¸âƒ£ Colored Noiseé‡‡æ ·

- æ—¶é—´ç›¸å…³å™ªå£°,è½¨è¿¹æ›´å¹³æ»‘
- ç¬¦åˆåŠ¨åŠ›å­¦ç‰¹æ€§
- å‚è€ƒMPPI-Genericæœ€ä½³å®è·µ

### 4ï¸âƒ£ æŒ‡æ•°ç¢°æ’æƒ©ç½š

- è½»å¾®ç¢°æ’: 100k (å¯æ¥å—æ¢ç´¢)
- å¤šæ¬¡ç¢°æ’: æŒ‡æ•°å¢é•¿ (200kâ†’400kâ†’800k)
- ä¸¥é‡ç¢°æ’: 1e8 (ç›´æ¥æ”¾å¼ƒ)
- ä¿ç•™costæ¢¯åº¦,MPPIèƒ½å­¦ä¹ 

### 5ï¸âƒ£ æ¨¡å—åŒ–è®¾è®¡

- Dynamics/Cost/Samplingåˆ†ç¦»
- æ˜“äºæ›¿æ¢ç»„ä»¶
- æ˜“äºæ‰©å±•æ–°åŠŸèƒ½

### 6ï¸âƒ£ GPUåŠ é€Ÿå°±ç»ª

- 4ä¸ªCUDA kernelå·²å®ç°
- 44%æ€§èƒ½æå‡å·²éªŒè¯
- åªå·®EDTæ•°æ®ä¼ é€’è°ƒè¯•

---

## ğŸ› å·²çŸ¥é—®é¢˜

### GPUéƒ¨åˆ†

- âš ï¸ **GPU mallocå´©æºƒ**: EDTæ•°æ®ä¼ é€’æ—¶å‡ºç°å†…å­˜é”™è¯¯
- **ä¸´æ—¶æ–¹æ¡ˆ**: use_gpu_=false (CPUç‰ˆæœ¬100%ç¨³å®š)
- **é¢„æœŸä¿®å¤æ—¶é—´**: 2å°æ—¶ (EDTæ¥å£è°ƒè¯•)
- **ç†è®ºåŠ é€Ÿ**: 10-50x

### B-splineä¼˜åŒ–

- âš ï¸ **å¶å°”reboundå¤±è´¥**: 20æ¬¡é‡è¯•åæ”¾å¼ƒ
- **å½“å‰å¤„ç†**: ç›´æ¥ä½¿ç”¨MPPIè½¨è¿¹ (å·²è¶³å¤Ÿå¹³æ»‘)
- **å½±å“**: æå° (~2%æƒ…å†µ)

---

## ğŸš§ æœªæ¥ä¼˜åŒ–

### Phase 1: å‚æ•°è°ƒä¼˜ (æœ¬å‘¨)
- ç½‘æ ¼æœç´¢æœ€ä¼˜å‚æ•°ç»„åˆ
- æ”¶é›†100æ¬¡è¿è¡Œç»Ÿè®¡æ•°æ®
- æ–‡æ¡£åŒ–æœ€ä½³å®è·µ

### Phase 2: è¿­ä»£MPPI (ä¸‹å‘¨)
- å®ç°MPPI-Generic Algorithm 1
- å¤šæ¬¡è¿­ä»£æå‡è´¨é‡ 30-50%
- æ§åˆ¶åˆ†å¸ƒæ›´æ–°æœºåˆ¶

### Phase 3: GPUåŠ é€Ÿ (2å‘¨)
- ä¿®å¤EDTä¼ é€’bug
- Shared Memoryä¼˜åŒ–
- Warp Shuffleä¼˜åŒ–
- é¢„æœŸ: 10-50xåŠ é€Ÿ

### Phase 4: é«˜çº§ç‰¹æ€§ (é•¿æœŸ)
- è‡ªé€‚åº”æ¸©åº¦å‚æ•°
- é‡è¦æ€§é‡‡æ ·
- å­¦ä¹ å‹costå‡½æ•°

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. **MPPIåŸå§‹è®ºæ–‡**:
   - Williams et al. "Information Theoretic MPC for Model-Based Reinforcement Learning" (2017)

2. **MPPI-Generic**:
   - https://github.com/ACDSLab/MPPI-Generic
   - æ¨¡å—åŒ–MPPIå®ç°å‚è€ƒ

3. **FastPlanner**:
   - Zhou et al. "Robust and Efficient Quadrotor Trajectory Generation for Fast Autonomous Flight" (2019)
   - æ‹“æ‰‘è§„åˆ’ + B-splineä¼˜åŒ–åŸºç¡€

4. **Colored Noise**:
   - Theodorou et al. "A Generalized Path Integral Control Approach to Reinforcement Learning" (2010)

---

## ğŸ“ License

MIT License

---

## ğŸ‘¥ Contributors

- **Original FastPlanner**: Boyu Zhou (HKUST)
- **MPPI Integration**: This project
- **MPPI-Generic Reference**: ACDSLab

---

## ğŸ“§ Contact

å¦‚æœ‰é—®é¢˜,è¯·æIssueæˆ–æŸ¥çœ‹ `goal.md` å’Œ `rules.md` äº†è§£é¡¹ç›®è§„èŒƒã€‚
